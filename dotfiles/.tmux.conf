##### Prefix #####
# prefixキーを C-b から C-a に変更
set -g prefix C-a
unbind C-b
bind C-a send-prefix

##### Terminal / Color #####
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256color*:Tc"
# (古い書き方: こちらでも動く場合がある)
set -ga terminal-overrides ",xterm-256color:RGB"

##### Clipboard / passthrough #####
set -g set-clipboard on
set -g allow-passthrough on

##### Mouse #####
# クリックでペイン選択・リサイズ・スクロール
set -g mouse on

##### WezTerm-friendly #####
# フォーカスイベント（weztermなど対応端末向け）
set -g focus-events on
# 複数ペイン/複数クライアントでサイズ安定
setw -g aggressive-resize on

##### Quality of life #####
# 設定リロード（prefix + r）
bind r source-file ~/.tmux.conf \; display-message "Reloaded ~/.tmux.conf"

# 反応をキビキビ（ESC待ち時間を短く）
set -s escape-time 10

# スクロール履歴
set -g history-limit 200000

# インデックスを 1 始まり（好み）
set -g base-index 1
setw -g pane-base-index 1

# ウィンドウを閉じたら番号を詰める
set -g renumber-windows on

# 新規ウィンドウ/分割でカレントディレクトリ引き継ぎ
bind c  new-window  -c "#{pane_current_path}"
bind %  split-window -h -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"

##### Copy-mode (vi) #####
setw -g mode-keys vi
# vで選択開始 / yでコピー（tmuxバッファへ）
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
# マウスドラッグ選択でもコピーして抜ける
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel

##### Pane navigation: Ctrl+h/j/k/l (tmux <-> nvim 共存) #####
# nvim/vim のときは Ctrl+h/j/k/l を nvim に渡す
# それ以外のときは tmux のペイン移動にする
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\S+/)?(n?vim)$'"

bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

##### Ops (optional but useful) #####
# 入力を全ペインに同時送信（同期）トグル：prefix + S
bind S setw synchronize-panes \; display-message "synchronize-panes: #{?pane_synchronized,on,off}"

# バックグラウンドで出力があったら通知
setw -g monitor-activity on
set -g visual-activity on

